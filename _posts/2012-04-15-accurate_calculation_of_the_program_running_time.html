---
layout: post
status: publish
published: true
title: 程序运行时间的精确计算
author:
  display_name: hippo
  login: admin
  email: kimiscircle@gmail.com
  url: http://blog.futureme.info
author_login: admin
author_email: kimiscircle@gmail.com
author_url: http://blog.futureme.info
wordpress_id: 50
wordpress_url: http://localhost/?p=46
date: '2012-04-15 21:32:54 +0800'
date_gmt: '2012-04-15 21:32:54 +0800'
categories:
- c&amp;c++
tags:
- c
- 运行时间
- 程序
comments: []
---
<div id="BlogArticleDetail" style="font-size: 14px;">                     &nbsp;&nbsp;&nbsp; 程序运行的时间复杂度在很多时候被用来衡量一个程序的可行性。除了宏观计算O(n)外，简单的程序自己也能提供其运行的时长。<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp; 1.简单的方法是，在C&#47;C++中，简单的就是，time.h,中的函数 clock_t 类型的变量接受 clock()函数的赋值，eg.<br &#47;><br &#47;>&nbsp;&nbsp;&nbsp;&nbsp; #include<stdio.h><br &#47;>#include<stdlib.h><br &#47;>#include<time.h><br &#47;>int main()<br &#47;><br &#47;>{<br &#47;><br &#47;>&nbsp;&nbsp;&nbsp; clock_t start,finish;<br &#47;>&nbsp;&nbsp;&nbsp; int sum=0,i;<br &#47;>&nbsp;&nbsp;&nbsp; start=clock();<br &#47;>&nbsp;&nbsp;&nbsp; for(i=3;i<1000;i++)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(i%3==0||i%5==0)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum+=i;<br &#47;>&nbsp;&nbsp;&nbsp; printf("%dn",sum);<br &#47;>&nbsp;&nbsp;&nbsp; finish=clock();<br &#47;>&nbsp;&nbsp;&nbsp; printf("lasts for %llf secondsn",(long&nbsp; double)(finish-start)&#47;CLOCKS_PER_SEC);<br &#47;>}<br &#47;><br &#47;>2,这种方法精确到1E-6，利用 sys&#47;time.h 中的 gettimeofday() 函数获取当前时钟，它精确到ms，普遍的用法是：<br &#47;>#include<stdio.h><br &#47;>#include<sys&#47;time.h><br &#47;>double getTimeval()<br &#47;>{<br &#47;>&nbsp;&nbsp;&nbsp; struct timeval stTimeval;<br &#47;>&nbsp;&nbsp;&nbsp; gettimeofday(&amp;stTimeval,NULL);<br &#47;>&nbsp;&nbsp;&nbsp; return stTimeval.tv_sec+(double)stTimeval.tv_usec*1E-6;<br &#47;>}<br &#47;>int main()<br &#47;>{<br &#47;>&nbsp;&nbsp;&nbsp; double T1,T2;<br &#47;>&nbsp;&nbsp;&nbsp; long long int i,sum=0;<br &#47;>&nbsp;&nbsp;&nbsp; long long int fa[100000]={0};<br &#47;>&nbsp;&nbsp;&nbsp; T1=getTimeval();<br &#47;>&nbsp;&nbsp;&nbsp; fa[0]=fa[1]=1;<br &#47;>&nbsp;&nbsp;&nbsp; for(i=1;fa[i+1]<4000000;i++)<br &#47;>&nbsp;&nbsp;&nbsp; {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fa[i+2]=fa[i+1]+fa[i];<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(fa[i+2]%2==0)<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum+=fa[i+2];<br &#47;>&nbsp;&nbsp;&nbsp; }<br &#47;>&nbsp;&nbsp;&nbsp; printf("%lldn",sum);<br &#47;>&nbsp;&nbsp;&nbsp; T2=getTimeval();<br &#47;>&nbsp;&nbsp;&nbsp; printf("Time result tested by gettimeofday= %10.30fn",<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (double)(T2-T1));<br &#47;>&nbsp;&nbsp;&nbsp; return 0;<br &#47;>}<br &#47;><br &#47;>3，通过测试另外的时间调用结果：<br &#47;><br &#47;>#include <sys&#47;time.h><br &#47;>#include <sys&#47;resource.h><br &#47;>#include <unistd.h><br &#47;>#include <stdio.h><br &#47;>#include <time.h><br &#47;><br &#47;>#define TEST_BY_CLOCK&nbsp;&nbsp; (char)(0x00)<br &#47;>#define TEST_BY_TIMES&nbsp;&nbsp; (char)(0x01)<br &#47;>#define TEST_BY_GETTIMEOFDAY (char)(0x02)<br &#47;>#define TEST_BY_GETRUSAGE&nbsp; (char)(0x03)<br &#47;>#define TEST_METHOD&nbsp;&nbsp;&nbsp; (TEST_BY_GETTIMEOFDAY)<br &#47;><br &#47;>#define COORDINATION_X&nbsp;&nbsp; (int)(1024)<br &#47;>#define COORDINATION_Y&nbsp;&nbsp; (int)(1024)<br &#47;><br &#47;>static int g_Matrix[COORDINATION_X][COORDINATION_Y];<br &#47;><br &#47;>double getTimeval()<br &#47;>{<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp; struct rusage stRusage;<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; struct timeval stTimeval;<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (TEST_METHOD == TEST_BY_GETTIMEOFDAY) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gettimeofday(&amp;stTimeval, NULL);<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (TEST_METHOD == TEST_BY_GETRUSAGE) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getrusage(RUSAGE_SELF, &amp;stRusage);<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stTimeval = stRusage.ru_utime;<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return stTimeval.tv_sec + (double)stTimeval.tv_usec*1E-6;<br &#47;>}<br &#47;><br &#47;>int main()<br &#47;>{<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp; int i, j;<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int n = 0;<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; clock_t clockT1, clockT2;<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double doubleT1, doubleT2;<br &#47;><br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (TEST_METHOD == TEST_BY_CLOCK) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; clockT1 = clock();<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (TEST_METHOD == TEST_BY_TIMES) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; times(&amp;clockT1);<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (TEST_METHOD == TEST_BY_GETTIMEOFDAY) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doubleT1 = getTimeval();<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (TEST_METHOD == TEST_BY_GETRUSAGE) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doubleT1 = getTimeval();<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br &#47;><br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (i = 0; i < COORDINATION_X; i++) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (j = 0; j < COORDINATION_Y; j++) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; g_Matrix[i][j] = i * j;<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br &#47;><br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (TEST_METHOD == TEST_BY_CLOCK) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; clockT2 = clock();<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf("Time result tested by clock = %10.30fn",<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (double)(clockT2 - clockT1)&#47;CLOCKS_PER_SEC);<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (TEST_METHOD == TEST_BY_TIMES) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; times(&amp;clockT2);<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf("Time result tested by times = %10.30fn",<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (double)(clockT2 - clockT1)&#47;sysconf(_SC_CLK_TCK));<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (TEST_METHOD == TEST_BY_GETTIMEOFDAY) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doubleT2 = getTimeval();<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf("Time result tested by gettimeofday = %10.30fn",<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (double)(doubleT2 - doubleT1));<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (TEST_METHOD == TEST_BY_GETRUSAGE) {<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; doubleT2 = getTimeval();<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf("Time result tested by getrusage = %10.70fn",<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (double)(doubleT2 - doubleT1));<br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br &#47;><br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;<br &#47;>}<br &#47;><br &#47;>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 比较后得出结果，对精度要求不高或程序运行时间比较长的情况下，clock()函数是个不错的选择，而对于精度要求较高时，gettimeofday() , getusage() 的结果似乎差不多。这就根据自己的爱好去使用了！<br &#47;><&#47;div></p>
